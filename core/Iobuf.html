<div class="ocaml_top"><div class="ocaml_summary"><div class="info">A non-moving (in the gc sense) contiguous range of bytes, useful for I/O operations.<p>An iobuf consists of:</p><ul><li>bigstring</li><li>limits -- a subrange of the bigstring</li><li>window -- a subrange of the limits</li></ul>All iobuf operations are restricted to operate within the limits. Initially, the
window of an iobuf is identical to the limits. A phantom type, &quot;seek&quot; permission,
controls whether or not code is allowed to change the limits and window. With seek
permission, the limits can be <code class="code">narrow</code>ed, but can never be widened, and the window can
be set to an arbitrary subrange of the limits.<p>A phantom type controls whether code can read and write bytes in the bigstring (within
the limits) or can only read them.</p><p>To present a restricted view of an iobuf to a client, one can create a sub-iobuf or
add a type constraint.</p></div></div>
<div class="ocaml_content"><div class="ocaml_include" items="[]" types="[&quot;seek&quot;]"><pre class="ocaml_include_handle"><span class="keyword">include</span> <code class="type"><code class="code">sig</code> .. <code class="code">end</code> with type <a href="http://mirage.github.io/core/#Iobuf.__pa_nonrec_0" class="ocaml_internal">__pa_nonrec_0</a> := <a href="http://mirage.github.io/core/#Iobuf_intf.seek">Iobuf_intf.seek</a></code></pre><div class="ocaml_summary"/><div class="ocaml_content">
<pre class="odoccode"><span class="TYPE__pa_nonrec_0"><span class="keyword">type</span> __pa_nonrec_0</span> = <code class="type"><a href="http://mirage.github.io/core/#Iobuf_intf.seek">Iobuf_intf.seek</a></code></pre>
<pre class="odoccode"><span class="TYPEseek"><span class="keyword">type</span> seek</span> = <code class="type"><a href="http://mirage.github.io/core/#Iobuf.__pa_nonrec_0" class="ocaml_internal">__pa_nonrec_0</a></code></pre></div></div>
<div class="ocaml_include" items="[]" types="[&quot;no_seek&quot;]"><pre class="ocaml_include_handle"><span class="keyword">include</span> <code class="type"><code class="code">sig</code> .. <code class="code">end</code> with type <a href="http://mirage.github.io/core/#Iobuf.__pa_nonrec_1" class="ocaml_internal">__pa_nonrec_1</a> := <a href="http://mirage.github.io/core/#Iobuf_intf.no_seek">Iobuf_intf.no_seek</a></code></pre><div class="ocaml_summary"/><div class="ocaml_content">
<pre class="odoccode"><span class="TYPE__pa_nonrec_1"><span class="keyword">type</span> __pa_nonrec_1</span> = <code class="type"><a href="http://mirage.github.io/core/#Iobuf_intf.no_seek">Iobuf_intf.no_seek</a></code></pre>
<pre class="odoccode"><span class="TYPEno_seek"><span class="keyword">type</span> no_seek</span> = <code class="type"><a href="http://mirage.github.io/core/#Iobuf.__pa_nonrec_1" class="ocaml_internal">__pa_nonrec_1</a></code></pre></div></div>
<pre class="odoccode"><span class="TYPEt"><span class="keyword">type</span> <code class="type">(+'data_perm_read_write, +'seek_permission) </code>t</span></pre><div class="info">The first type parameter controls whether the iobuf can be written to.
The second type parameter controls whether the window and limits can be changed.<p>To allow <code class="code">read_write</code> or <code class="code">read_only</code> access, a function's type uses <code class="code">_</code> rather than
<code class="code">read_only</code> as the type argument to <code class="code">t</code>. Analogously, to allow <code class="code">no_seek</code> or <code class="code">seek</code>
access, a function's type uses <code class="code">_</code> rather than <code class="code">no_seek</code> as the type argument to <code class="code">t</code>.
Using <code class="code">_</code> allows the function to be directly applied to either permission. Using
a specific permission would require code to use coercion <code class="code">:&gt;</code>.</p></div>
<div class="ocaml_include" path="http://mirage.github.io/core/#Invariant:S2" items="[]" types="[]"><pre class="ocaml_include_handle"><span class="keyword">include</span> <code class="type"><code class="code"><a href="http://mirage.github.io/core/#Invariant:S2">Invariant.S2</a></code> with type t := ('a, 'b) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a></code></pre><div class="ocaml_summary"/></div>
<div class="info"><h1 id="1_TITLE">Creation</h1></div>
<pre class="odoccode"><span class="VALcreate"><span class="keyword">val</span> create</span> : <code class="type">len:int -&gt; ('a, 'b) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a></code></pre><div class="info"><code class="code">create ~len</code> creates a new iobuf, backed by a bigstring of length <code class="code">len</code>,
with the limits and window set to the entire bigstring.</div>
<pre class="odoccode"><span class="VALof_bigstring"><span class="keyword">val</span> of_bigstring</span> : <code class="type">?pos:int -&gt; ?len:int -&gt; <a href="http://mirage.github.io/core/#Bigstring.t">Bigstring.t</a> -&gt; ('a, 'b) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a></code></pre><div class="info"><code class="code">of_bigstring bigstring ~pos ~len</code> returns an iobuf backed by <code class="code">bigstring</code>, with the
window and limits specified starting at <code class="code">pos</code> and of length <code class="code">len</code>.</div>
<pre class="odoccode"><span class="VALof_string"><span class="keyword">val</span> of_string</span> : <code class="type">string -&gt; ('a, 'b) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a></code></pre><div class="info"><code class="code">of_string s</code> returns a new iobuf whose contents are <code class="code">s</code>.</div>
<pre class="odoccode"><span class="VALsub"><span class="keyword">val</span> sub</span> : <code class="type">?pos:int -&gt; ?len:int -&gt; ('d, 'a) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; ('d, 'b) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a></code></pre><div class="info"><code class="code">sub t ~pos ~len</code> returns a new iobuf with limits and window set to the subrange of
<code class="code">t</code> specified by <code class="code">pos</code> and <code class="code">len</code>. <code class="code">sub</code> preserves data permissions, but allows
arbitrary seek permissions on the resulting iobuf.</div>
<pre class="odoccode"><span class="VALset_bounds_and_buffer"><span class="keyword">val</span> set_bounds_and_buffer</span> : <code class="type">src:(<a href="http://mirage.github.io/core/#Common.read_write">Common.read_write</a>, 'a) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; dst:('b, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; unit</code></pre><div class="info"><code class="code">set_bounds_and_buffer ~src ~dst</code> copies bounds (ie limits + window) and shallowly
copies the buffer from <code class="code">src</code> to <code class="code">dst</code>. <code class="code">read_write</code> access is required on <code class="code">src</code>
because the caller might have <code class="code">read_write</code> access to <code class="code">dst</code>, and would after the call
then effectively have <code class="code">read_write</code> access to <code class="code">src</code>.</div>
<pre class="odoccode"><span class="VALset_bounds_and_buffer_sub"><span class="keyword">val</span> set_bounds_and_buffer_sub</span> : <code class="type">?pos:int -&gt;
?len:int -&gt; src:(<a href="http://mirage.github.io/core/#Common.read_write">Common.read_write</a>, 'a) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; dst:('b, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; unit -&gt; unit</code></pre><div class="info"><code class="code">set_bounds_and_buffer_sub ?pos ?len ~src ~dst ()</code> is a more efficient version of:
<code class="code">set_bounds_and_buffer ~src:(Iobuf.sub ?pos ?len src) ~dst</code>.<p><code class="code">set_bounds_and_buffer ~src ~dst</code> is not the same as
<code class="code">set_bounds_and_buffer_sub ~dst ~src ()</code>, because the limits are narrowed in the
latter case.</p></div>
<div class="info"><h1 id="1_TITLE">Accessors</h1></div>
<pre class="odoccode"><span class="VALcapacity"><span class="keyword">val</span> capacity</span> : <code class="type">('a, 'b) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; int</code></pre><div class="info"><code class="code">capacity t</code> returns the size of <code class="code">t</code>'s limits subrange. The capacity of an iobuf can
be reduced via <code class="code">narrow</code>.</div>
<pre class="odoccode"><span class="VALlength"><span class="keyword">val</span> length</span> : <code class="type">('a, 'b) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; int</code></pre><div class="info"><code class="code">length t</code> returns the size of <code class="code">t</code>'s window.</div>
<pre class="odoccode"><span class="VALis_empty"><span class="keyword">val</span> is_empty</span> : <code class="type">('a, 'b) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; bool</code></pre><div class="info"><code class="code">is_empty t</code> is <code class="code">length t = 0</code>.</div>
<div class="info"><h1 id="1_TITLE">Changing the limits</h1></div>
<pre class="odoccode"><span class="VALnarrow"><span class="keyword">val</span> narrow</span> : <code class="type">('a, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; unit</code></pre><div class="info"><code class="code">narrow t</code> sets <code class="code">t</code>'s limits to the current window.</div>
<div class="info"><h1 id="1_TITLE">Changing the window</h1></div>
<div class="info">One can call <code class="code">Lo_bound.window t</code> to get a snapshot of the lower bound of the
window, and then later restore that snapshot with <code class="code">Lo_bound.restore</code>. This is
useful for speculatively parsing, and then rewinding when there isn't enough data to
finish.<p>Similarly for <code class="code">Hi_bound.window</code> and <code class="code">Lo_bound.restore</code>.</p><p>Using a snapshot with a different iobuf, even a sub iobuf of the snapshotted one, has
unspecified results. An exception may be raised, or a silent error may occur.
However, the safety guarantees of the iobuf will not be violated, i.e., the attempt
will not enlarge the limits of the subject iobuf.</p></div>
<div class="ocaml_modtype" name="Bound" path="http://mirage.github.io/core/#Iobuf_intf:Bound"><pre class="odoccode"><span class="keyword">module type</span> <a href="http://mirage.github.io/core/#Iobuf:Bound" class="ocaml_internal">Bound</a> = <code class="type"><code class="code"><a href="http://mirage.github.io/core/#Iobuf_intf:Bound">Iobuf_intf.Bound</a></code> with type iobuf := ('d, 'w) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a></code></pre><div class="ocaml_summary"/></div>
<div class="ocaml_module" name="Lo_bound" path="http://mirage.github.io/core/#Iobuf:Bound"><pre class="odoccode"><span class="keyword">module</span> <a href="http://mirage.github.io/core/#Iobuf.Lo_bound" class="ocaml_internal">Lo_bound</a> : <code class="type"><code class="code"><a href="http://mirage.github.io/core/#Iobuf:Bound" class="ocaml_internal">Bound</a></code></code></pre><div class="ocaml_summary"/></div>
<div class="ocaml_module" name="Hi_bound" path="http://mirage.github.io/core/#Iobuf:Bound"><pre class="odoccode"><span class="keyword">module</span> <a href="http://mirage.github.io/core/#Iobuf.Hi_bound" class="ocaml_internal">Hi_bound</a> : <code class="type"><code class="code"><a href="http://mirage.github.io/core/#Iobuf:Bound" class="ocaml_internal">Bound</a></code></code></pre><div class="ocaml_summary"/></div>
<pre class="odoccode"><span class="VALadvance"><span class="keyword">val</span> advance</span> : <code class="type">('a, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; int -&gt; unit</code></pre><div class="info"><code class="code">advance t amount</code> advances the lower bound of the window by <code class="code">amount</code>. It is an error
to advance past the upper bound of the window or the lower limit.</div>
<pre class="odoccode"><span class="VALresize"><span class="keyword">val</span> resize</span> : <code class="type">('a, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; len:int -&gt; unit</code></pre><div class="info"><code class="code">resize t</code> sets the length of <code class="code">t</code>'s window, provided it does not exceed limits.</div>
<pre class="odoccode"><span class="VALrewind"><span class="keyword">val</span> rewind</span> : <code class="type">('a, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; unit</code></pre><div class="info"><code class="code">rewind t</code> sets the lower bound of the window to the lower limit.</div>
<pre class="odoccode"><span class="VALreset"><span class="keyword">val</span> reset</span> : <code class="type">('a, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; unit</code></pre><div class="info"><code class="code">reset t</code> sets the window to the limits.</div>
<pre class="odoccode"><span class="VALflip_lo"><span class="keyword">val</span> flip_lo</span> : <code class="type">('a, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; unit</code></pre><div class="info"><code class="code">flip_lo t</code> sets the window to range from the lower limit to the lower bound of the
old window. This is typically called after a series of <code class="code">Fill</code>s, to reposition the
window in preparation to <code class="code">Consume</code> the newly written data.<p>The bounded version narrows the effective limit. This can preserve some data near the
limit, such as an hypothetical packet header, in the case of <code class="code">bounded_flip_lo</code> or
unfilled suffix of a buffer, in <code class="code">bounded_flip_hi</code>.</p></div>
<pre class="odoccode"><span class="VALbounded_flip_lo"><span class="keyword">val</span> bounded_flip_lo</span> : <code class="type">('a, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; <a href="http://mirage.github.io/core/#Iobuf.Lo_bound.t" class="ocaml_internal">Lo_bound.t</a> -&gt; unit</code></pre>
<pre class="odoccode"><span class="VALcompact"><span class="keyword">val</span> compact</span> : <code class="type">(<a href="http://mirage.github.io/core/#Common.read_write">Common.read_write</a>, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; unit</code></pre><div class="info"><code class="code">compact t</code> copies data from the window to the lower limit of the iobuf and sets the
window to range from the end of the copied data to the upper limit. This is typically
called after a series of <code class="code">Consume</code>s to save unread data and prepare for the next
series of <code class="code">Fill</code>s and <code class="code">flip_lo</code>.</div>
<pre class="odoccode"><span class="VALbounded_compact"><span class="keyword">val</span> bounded_compact</span> : <code class="type">(<a href="http://mirage.github.io/core/#Common.read_write">Common.read_write</a>, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; <a href="http://mirage.github.io/core/#Iobuf.Lo_bound.t" class="ocaml_internal">Lo_bound.t</a> -&gt; <a href="http://mirage.github.io/core/#Iobuf.Hi_bound.t" class="ocaml_internal">Hi_bound.t</a> -&gt; unit</code></pre>
<pre class="odoccode"><span class="VALflip_hi"><span class="keyword">val</span> flip_hi</span> : <code class="type">('a, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; unit</code></pre><div class="info"><code class="code">flip_hi t</code> sets the window to range from the the upper bound of the current window to
the upper limit. This operation is dual to <code class="code">flip_lo</code> and is typically called when the
data in the current (narrowed) window has been processed and the window needs to be
positioned over the remaining data in the buffer. For example:<pre class="code"><code>      (* ... determine initial_data_len ... *)
      Iobuf.resize buf ~len:initial_data_len;
      (* ... and process initial data ... *)
      Iobuf.flip_hi buf;</code></pre><p>Now the window of <code class="code">buf</code> ranges over the remainder of the data.</p></div>
<pre class="odoccode"><span class="VALbounded_flip_hi"><span class="keyword">val</span> bounded_flip_hi</span> : <code class="type">('a, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; <a href="http://mirage.github.io/core/#Iobuf.Hi_bound.t" class="ocaml_internal">Hi_bound.t</a> -&gt; unit</code></pre>
<div class="info"><h1 id="1_TITLE">Getting and setting data</h1></div>
<div class="info">&quot;consume&quot; and &quot;fill&quot; functions access data at the lower bound of the window and
advance lower bound of the window. &quot;peek&quot; and &quot;poke&quot; functions access data but do not
advance the window.</div>
<pre class="odoccode"><span class="VALto_string"><span class="keyword">val</span> to_string</span> : <code class="type">?len:int -&gt; ('a, 'b) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; string</code></pre><div class="info"><code class="code">to_string t</code> returns the bytes in <code class="code">t</code> as a string. It does not alter the window.</div>
<pre class="odoccode"><span class="VALconsume_into_string"><span class="keyword">val</span> consume_into_string</span> : <code class="type">?pos:int -&gt; ?len:int -&gt; ('a, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; string -&gt; unit</code></pre><div class="info"><code class="code">consume_into_string t s ~pos ~len</code> reads <code class="code">len</code> bytes from <code class="code">t</code>, advancing <code class="code">t</code>'s window
accordingly, and writes them into <code class="code">s</code> starting at <code class="code">pos</code>. By default <code class="code">pos = 0</code> and
<code class="code">len = String.length s - pos</code>. It is an error if <code class="code">pos</code> and <code class="code">len</code> don't specify a
valid region of <code class="code">s</code> or <code class="code">len &gt; length t</code>.</div>
<pre class="odoccode"><span class="VALconsume_into_bigstring"><span class="keyword">val</span> consume_into_bigstring</span> : <code class="type">?pos:int -&gt; ?len:int -&gt; ('a, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; <a href="http://mirage.github.io/core/#Bigstring.t">Bigstring.t</a> -&gt; unit</code></pre>
<div class="ocaml_module" name="Consume" path="http://mirage.github.io/core/#Iobuf_intf:Accessors"><pre class="odoccode"><span class="keyword">module</span> <a href="http://mirage.github.io/core/#Iobuf.Consume" class="ocaml_internal">Consume</a> : <code class="type"><code class="code"><a href="http://mirage.github.io/core/#Iobuf_intf:Accessors">Iobuf_intf.Accessors</a></code> with type t = ('d, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; 'a with type bin_prot := 'a <a href="http://mirage.github.io/bin_prot/#Type_class.reader">Bin_prot.Type_class.reader</a></code></pre><div class="ocaml_summary"><div class="info"><code class="code">Consume.string t ~len</code> reads <code class="code">len</code> characters (all, by default) from <code class="code">t</code> into a new
string and advances the lower bound of the window accordingly.<p><code class="code">Consume.bin_prot X.bin_read_t t</code> returns the initial <code class="code">X.t</code> in <code class="code">t</code>, advancing past the
bytes read.</p></div></div></div>
<div class="ocaml_module" name="Fill" path="http://mirage.github.io/core/#Iobuf_intf:Accessors"><pre class="odoccode"><span class="keyword">module</span> <a href="http://mirage.github.io/core/#Iobuf.Fill" class="ocaml_internal">Fill</a> : <code class="type"><code class="code"><a href="http://mirage.github.io/core/#Iobuf_intf:Accessors">Iobuf_intf.Accessors</a></code> with type t = (<a href="http://mirage.github.io/core/#Common.read_write">Common.read_write</a>, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; 'a -&gt; unit with type bin_prot := 'a <a href="http://mirage.github.io/bin_prot/#Type_class.writer">Bin_prot.Type_class.writer</a></code></pre><div class="ocaml_summary"><div class="info"><code class="code">Fill.bin_prot X.bin_write_t t x</code> writes <code class="code">x</code> to <code class="code">t</code> in bin-prot form, advancing past
the bytes written.</div></div></div>
<div class="ocaml_module" name="Peek" path="http://mirage.github.io/core/#Iobuf_intf:Accessors"><pre class="odoccode"><span class="keyword">module</span> <a href="http://mirage.github.io/core/#Iobuf.Peek" class="ocaml_internal">Peek</a> : <code class="type"><code class="code"><a href="http://mirage.github.io/core/#Iobuf_intf:Accessors">Iobuf_intf.Accessors</a></code> with type t = ('d, 'w) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; pos:int -&gt; 'a with type bin_prot := 'a <a href="http://mirage.github.io/bin_prot/#Type_class.reader">Bin_prot.Type_class.reader</a></code></pre><div class="ocaml_summary"><div class="info"><code class="code">Peek</code> and <code class="code">Poke</code> functions access a value at <code class="code">pos</code> from the lower bound of the window
and do not advance.<p><code class="code">Peek.bin_prot X.bin_read_t t</code> returns the initial <code class="code">X.t</code> in <code class="code">t</code> without advancing.</p><p>Following the <code class="code">bin_prot</code> protocol, the representation of <code class="code">x</code> is <code class="code">X.bin_size_t x</code> bytes
long. <code class="code">Peek.</code>, <code class="code">Poke.</code>, <code class="code">Consume.</code>, and <code class="code">Fill.bin_prot</code> do not add any size prefix or
other framing to the <code class="code">bin_prot</code> representation.</p></div></div></div>
<div class="ocaml_module" name="Poke" path="http://mirage.github.io/core/#Iobuf_intf:Accessors"><pre class="odoccode"><span class="keyword">module</span> <a href="http://mirage.github.io/core/#Iobuf.Poke" class="ocaml_internal">Poke</a> : <code class="type"><code class="code"><a href="http://mirage.github.io/core/#Iobuf_intf:Accessors">Iobuf_intf.Accessors</a></code> with type t = (<a href="http://mirage.github.io/core/#Common.read_write">Common.read_write</a>, 'w) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; pos:int -&gt; 'a -&gt; unit with type bin_prot := 'a <a href="http://mirage.github.io/bin_prot/#Type_class.writer">Bin_prot.Type_class.writer</a></code></pre><div class="ocaml_summary"><div class="info"><code class="code">Poke.bin_prot X.bin_write_t t x</code> writes <code class="code">x</code> to the beginning of <code class="code">t</code> in binary form
without advancing. You can use <code class="code">X.bin_size_t</code> to tell how long it was.
<code class="code">X.bin_write_t</code> is only allowed to write that portion of the buffer to which you have
access.</div></div></div>
<div class="ocaml_module" name="Unsafe"><pre class="odoccode"><span class="keyword">module</span> <a href="http://mirage.github.io/core/#Iobuf.Unsafe" class="ocaml_internal">Unsafe</a> : <code class="type"><code class="code">sig</code> .. <code class="code">end</code></code></pre><div class="ocaml_summary"><div class="info"><code class="code">Unsafe</code> has submodules that are like their corresponding module, except with no range
checks. Hence, mistaken uses can cause segfaults. Be careful!</div></div><div class="ocaml_content">
<div class="ocaml_module" name="Consume" path="http://mirage.github.io/core/#Iobuf.Consume"><pre class="odoccode"><span class="keyword">module</span> <a href="http://mirage.github.io/core/#Iobuf.Unsafe.Consume" class="ocaml_internal">Consume</a> : <code class="type">module type of <code class="code"><a href="http://mirage.github.io/core/#Iobuf.Consume" class="ocaml_internal">Consume</a></code></code></pre><div class="ocaml_summary"/></div>
<div class="ocaml_module" name="Fill" path="http://mirage.github.io/core/#Iobuf.Fill"><pre class="odoccode"><span class="keyword">module</span> <a href="http://mirage.github.io/core/#Iobuf.Unsafe.Fill" class="ocaml_internal">Fill</a> : <code class="type">module type of <code class="code"><a href="http://mirage.github.io/core/#Iobuf.Fill" class="ocaml_internal">Fill</a></code></code></pre><div class="ocaml_summary"/></div>
<div class="ocaml_module" name="Peek" path="http://mirage.github.io/core/#Iobuf.Peek"><pre class="odoccode"><span class="keyword">module</span> <a href="http://mirage.github.io/core/#Iobuf.Unsafe.Peek" class="ocaml_internal">Peek</a> : <code class="type">module type of <code class="code"><a href="http://mirage.github.io/core/#Iobuf.Peek" class="ocaml_internal">Peek</a></code></code></pre><div class="ocaml_summary"/></div>
<div class="ocaml_module" name="Poke" path="http://mirage.github.io/core/#Iobuf.Poke"><pre class="odoccode"><span class="keyword">module</span> <a href="http://mirage.github.io/core/#Iobuf.Unsafe.Poke" class="ocaml_internal">Poke</a> : <code class="type">module type of <code class="code"><a href="http://mirage.github.io/core/#Iobuf.Poke" class="ocaml_internal">Poke</a></code></code></pre><div class="ocaml_summary"/></div></div></div>
<pre class="odoccode"><span class="VALfill_bin_prot"><span class="keyword">val</span> fill_bin_prot</span> : <code class="type">(<a href="http://mirage.github.io/core/#Common.read_write">Common.read_write</a>, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt;
'a <a href="http://mirage.github.io/bin_prot/#Type_class.writer">Bin_prot.Type_class.writer</a> -&gt; 'a -&gt; unit <a href="http://mirage.github.io/core/#Or_error.t">Or_error.t</a></code></pre><div class="info"><code class="code">fill_bin_prot</code> writes a bin-prot value to the lower bound of the window, prefixed by
its length, and advances by the amount written. <code class="code">fill_bin_prot</code> returns an error if
the window is too small to write the value.<p><code class="code">consume_bin_prot t reader</code> reads a bin-prot value from the lower bound of the window,
which should have been written using <code class="code">fill_bin_prot</code>, and advances the window by the
amount read. <code class="code">consume_bin_prot</code> returns an error if there is not a complete message
in the window and in that case the window is left unchanged.</p></div>
<pre class="odoccode"><span class="VALconsume_bin_prot"><span class="keyword">val</span> consume_bin_prot</span> : <code class="type">('b, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; 'a <a href="http://mirage.github.io/bin_prot/#Type_class.reader">Bin_prot.Type_class.reader</a> -&gt; 'a <a href="http://mirage.github.io/core/#Or_error.t">Or_error.t</a></code></pre>
<pre class="odoccode"><span class="VALtransfer"><span class="keyword">val</span> transfer</span> : <code class="type">?len:int -&gt; src:('a, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; dst:(<a href="http://mirage.github.io/core/#Common.read_write">Common.read_write</a>, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; unit</code></pre><div class="info"><code class="code">transfer</code> blits <code class="code">len</code> bytes from <code class="code">src</code> to <code class="code">dst</code>, advancing the lower bounds of both
windows. It is an error if <code class="code">len &gt; length src || len &gt; length dst || phys_equal src
    dst</code>.</div>
<pre class="odoccode"><span class="VALmemmove"><span class="keyword">val</span> memmove</span> : <code class="type">(<a href="http://mirage.github.io/core/#Common.read_write">Common.read_write</a>, 'a) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; src_pos:int -&gt; dst_pos:int -&gt; len:int -&gt; unit</code></pre><div class="info"><code class="code">memmove</code> blits <code class="code">len</code> bytes from <code class="code">src_pos</code> to <code class="code">dst_pos</code> in an iobuf, both relative to
the lower bound of the window. The window is not advanced.</div>
<div class="info"><h1 id="1_TITLE">I/O</h1></div>
<pre class="odoccode"><span class="VALread_assume_fd_is_nonblocking"><span class="keyword">val</span> read_assume_fd_is_nonblocking</span> : <code class="type">(<a href="http://mirage.github.io/core/#Common.read_write">Common.read_write</a>, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; <a href="http://mirage.github.io/core/#Iobuf_intf.Unix.File_descr.t">Iobuf_intf.Unix.File_descr.t</a> -&gt; int</code></pre><div class="info"><code class="code">Iobuf</code> has analogs of various <code class="code">Bigstring</code> functions. These analogs advance by the
amount written/read.</div>
<pre class="odoccode"><span class="VALpread_assume_fd_is_nonblocking"><span class="keyword">val</span> pread_assume_fd_is_nonblocking</span> : <code class="type">(<a href="http://mirage.github.io/core/#Common.read_write">Common.read_write</a>, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt;
<a href="http://mirage.github.io/core/#Iobuf_intf.Unix.File_descr.t">Iobuf_intf.Unix.File_descr.t</a> -&gt; offset:int -&gt; int</code></pre>
<pre class="odoccode"><span class="VALrecvfrom_assume_fd_is_nonblocking"><span class="keyword">val</span> recvfrom_assume_fd_is_nonblocking</span> : <code class="type">(<a href="http://mirage.github.io/core/#Common.read_write">Common.read_write</a>, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt;
<a href="http://mirage.github.io/core/#Iobuf_intf.Unix.File_descr.t">Iobuf_intf.Unix.File_descr.t</a> -&gt; int * <a href="http://mirage.github.io/core/#Iobuf_intf.Unix.sockaddr">Iobuf_intf.Unix.sockaddr</a></code></pre>
<pre class="odoccode"><span class="VALrecvmmsg_assume_fd_is_nonblocking"><span class="keyword">val</span> recvmmsg_assume_fd_is_nonblocking</span> : <code class="type">(<a href="http://mirage.github.io/core/#Iobuf_intf.Unix.File_descr.t">Iobuf_intf.Unix.File_descr.t</a> -&gt;
 ?count:int -&gt;
 ?srcs:<a href="http://mirage.github.io/core/#Iobuf_intf.Unix.sockaddr">Iobuf_intf.Unix.sockaddr</a> array -&gt;
 (<a href="http://mirage.github.io/core/#Common.read_write">Common.read_write</a>, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> array -&gt; int)
<a href="http://mirage.github.io/core/#Or_error.t">Or_error.t</a></code></pre>
<pre class="odoccode"><span class="VALrecvmmsg_assume_fd_is_nonblocking_no_options"><span class="keyword">val</span> recvmmsg_assume_fd_is_nonblocking_no_options</span> : <code class="type">(<a href="http://mirage.github.io/core/#Iobuf_intf.Unix.File_descr.t">Iobuf_intf.Unix.File_descr.t</a> -&gt;
 count:int -&gt; (<a href="http://mirage.github.io/core/#Common.read_write">Common.read_write</a>, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> array -&gt; int)
<a href="http://mirage.github.io/core/#Or_error.t">Or_error.t</a></code></pre>
<pre class="odoccode"><span class="VALsend_nonblocking_no_sigpipe"><span class="keyword">val</span> send_nonblocking_no_sigpipe</span> : <code class="type">unit -&gt;
(('a, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; <a href="http://mirage.github.io/core/#Iobuf_intf.Unix.File_descr.t">Iobuf_intf.Unix.File_descr.t</a> -&gt; int option) <a href="http://mirage.github.io/core/#Or_error.t">Or_error.t</a></code></pre>
<pre class="odoccode"><span class="VALsendto_nonblocking_no_sigpipe"><span class="keyword">val</span> sendto_nonblocking_no_sigpipe</span> : <code class="type">unit -&gt;
(('a, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt;
 <a href="http://mirage.github.io/core/#Iobuf_intf.Unix.File_descr.t">Iobuf_intf.Unix.File_descr.t</a> -&gt; <a href="http://mirage.github.io/core/#Iobuf_intf.Unix.sockaddr">Iobuf_intf.Unix.sockaddr</a> -&gt; int option)
<a href="http://mirage.github.io/core/#Or_error.t">Or_error.t</a></code></pre>
<pre class="odoccode"><span class="VALwrite_assume_fd_is_nonblocking"><span class="keyword">val</span> write_assume_fd_is_nonblocking</span> : <code class="type">('a, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; <a href="http://mirage.github.io/core/#Iobuf_intf.Unix.File_descr.t">Iobuf_intf.Unix.File_descr.t</a> -&gt; int</code></pre>
<pre class="odoccode"><span class="VALpwrite_assume_fd_is_nonblocking"><span class="keyword">val</span> pwrite_assume_fd_is_nonblocking</span> : <code class="type">('a, <a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a>) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; <a href="http://mirage.github.io/core/#Iobuf_intf.Unix.File_descr.t">Iobuf_intf.Unix.File_descr.t</a> -&gt; offset:int -&gt; int</code></pre>
<pre class="odoccode"><span class="VALsexp_of_seek"><span class="keyword">val</span> sexp_of_seek</span> : <code class="type"><a href="http://mirage.github.io/core/#Iobuf.seek" class="ocaml_internal">seek</a> -&gt; <a href="http://mirage.github.io/sexplib/#Sexp.t">Sexplib.Sexp.t</a></code></pre>
<pre class="odoccode"><span class="VALsexp_of_no_seek"><span class="keyword">val</span> sexp_of_no_seek</span> : <code class="type"><a href="http://mirage.github.io/core/#Iobuf.no_seek" class="ocaml_internal">no_seek</a> -&gt; <a href="http://mirage.github.io/sexplib/#Sexp.t">Sexplib.Sexp.t</a></code></pre>
<pre class="odoccode"><span class="VALsexp_of_t"><span class="keyword">val</span> sexp_of_t</span> : <code class="type">('data_perm_read_write -&gt; <a href="http://mirage.github.io/sexplib/#Sexp.t">Sexplib.Sexp.t</a>) -&gt;
('seek_permission -&gt; <a href="http://mirage.github.io/sexplib/#Sexp.t">Sexplib.Sexp.t</a>) -&gt;
('data_perm_read_write, 'seek_permission) <a href="http://mirage.github.io/core/#Iobuf.t" class="ocaml_internal">t</a> -&gt; <a href="http://mirage.github.io/sexplib/#Sexp.t">Sexplib.Sexp.t</a></code></pre>
</div></div>